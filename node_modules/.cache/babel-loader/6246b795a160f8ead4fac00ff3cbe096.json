{"ast":null,"code":"import { rest, setupWorker } from 'msw';\nimport { factory, oneOf, manyOf, primaryKey } from '@mswjs/data';\nimport { nanoid } from '@reduxjs/toolkit';\nimport faker from 'faker';\nimport seedrandom from 'seedrandom';\nimport { Server as MockSocketServer } from 'mock-socket';\nimport { setRandom } from 'txtgen';\nimport { parseISO } from 'date-fns';\nconst NUM_USERS = 3;\nconst POSTS_PER_USER = 3;\nconst RECENT_NOTIFICATIONS_DAYS = 7; // Add an extra delay to all endpoints, so loading spinners show up.\n\nconst ARTIFICIAL_DELAY_MS = 2000;\n/* RNG setup */\n// Set up a seeded random number generator, so that we get\n// a consistent set of users / entries each time the page loads.\n// This can be reset by deleting this localStorage value,\n// or turned off by setting `useSeededRNG` to false.\n\nlet useSeededRNG = true;\nlet rng = seedrandom();\n\nif (useSeededRNG) {\n  let randomSeedString = localStorage.getItem('randomTimestampSeed');\n  let seedDate;\n\n  if (randomSeedString) {\n    seedDate = new Date(randomSeedString);\n  } else {\n    seedDate = new Date();\n    randomSeedString = seedDate.toISOString();\n    localStorage.setItem('randomTimestampSeed', randomSeedString);\n  }\n\n  rng = seedrandom(randomSeedString);\n  setRandom(rng);\n  faker.seed(seedDate.getTime());\n}\n\nfunction getRandomInt(min, max) {\n  min = Math.ceil(min);\n  max = Math.floor(max);\n  return Math.floor(rng() * (max - min + 1)) + min;\n}\n\nconst randomFromArray = array => {\n  const index = getRandomInt(0, array.length - 1);\n  return array[index];\n};\n/* MSW Data Model Setup */\n\n\nexport const db = factory({\n  user: {\n    id: primaryKey(nanoid),\n    firstName: String,\n    lastName: String,\n    name: String,\n    username: String,\n    posts: manyOf('post')\n  },\n  post: {\n    id: primaryKey(nanoid),\n    title: String,\n    date: String,\n    content: String,\n    reactions: oneOf('reaction'),\n    comments: manyOf('comment'),\n    user: oneOf('user')\n  },\n  comment: {\n    id: primaryKey(String),\n    date: String,\n    text: String,\n    post: oneOf('post')\n  },\n  reaction: {\n    id: primaryKey(nanoid),\n    thumbsUp: Number,\n    hooray: Number,\n    heart: Number,\n    rocket: Number,\n    eyes: Number,\n    post: oneOf('post')\n  }\n});\n\nconst createUserData = () => {\n  const firstName = faker.name.firstName();\n  const lastName = faker.name.lastName();\n  return {\n    firstName,\n    lastName,\n    name: `${firstName} ${lastName}`,\n    username: faker.internet.userName()\n  };\n};\n\nconst createPostData = user => {\n  return {\n    title: faker.lorem.words(),\n    date: faker.date.recent(RECENT_NOTIFICATIONS_DAYS).toISOString(),\n    user,\n    content: faker.lorem.paragraphs(),\n    reactions: db.reaction.create()\n  };\n}; // Create an initial set of users and posts\n\n\nfor (let i = 0; i < NUM_USERS; i++) {\n  const author = db.user.create(createUserData());\n\n  for (let j = 0; j < POSTS_PER_USER; j++) {\n    const newPost = createPostData(author);\n    db.post.create(newPost);\n  }\n}\n\nconst serializePost = post => ({ ...post,\n  user: post.user.id\n});\n/* MSW REST API Handlers */\n\n\nexport const handlers = [rest.get('/fakeApi/posts', function (req, res, ctx) {\n  const posts = db.post.getAll().map(serializePost);\n  return res(ctx.delay(ARTIFICIAL_DELAY_MS), ctx.json(posts));\n}), rest.post('/fakeApi/posts', function (req, res, ctx) {\n  const data = req.body;\n\n  if (data.content === 'error') {\n    return res(ctx.delay(ARTIFICIAL_DELAY_MS), ctx.status(500), ctx.json('Server error saving this post!'));\n  }\n\n  data.date = new Date().toISOString();\n  const user = db.user.findFirst({\n    where: {\n      id: {\n        equals: data.user\n      }\n    }\n  });\n  data.user = user;\n  data.reactions = db.reaction.create();\n  const post = db.post.create(data);\n  return res(ctx.delay(ARTIFICIAL_DELAY_MS), ctx.json(serializePost(post)));\n}), rest.get('/fakeApi/posts/:postId', function (req, res, ctx) {\n  const post = db.post.findFirst({\n    where: {\n      id: {\n        equals: req.params.postId\n      }\n    }\n  });\n  return res(ctx.delay(ARTIFICIAL_DELAY_MS), ctx.json(serializePost(post)));\n}), rest.patch('/fakeApi/posts/:postId', (req, res, ctx) => {\n  const {\n    id,\n    ...data\n  } = req.body;\n  const updatedPost = db.post.update({\n    where: {\n      id: {\n        equals: req.params.postId\n      }\n    },\n    data\n  });\n  return res(ctx.delay(ARTIFICIAL_DELAY_MS), ctx.json(serializePost(updatedPost)));\n}), rest.get('/fakeApi/posts/:postId/comments', (req, res, ctx) => {\n  const post = db.post.findFirst({\n    where: {\n      id: {\n        equals: req.params.postId\n      }\n    }\n  });\n  return res(ctx.delay(ARTIFICIAL_DELAY_MS), ctx.json({\n    comments: post.comments\n  }));\n}), rest.post('/fakeApi/posts/:postId/reactions', (req, res, ctx) => {\n  const postId = req.params.postId;\n  const reaction = req.body.reaction;\n  const post = db.post.findFirst({\n    where: {\n      id: {\n        equals: postId\n      }\n    }\n  });\n  const updatedPost = db.post.update({\n    where: {\n      id: {\n        equals: postId\n      }\n    },\n    data: {\n      reactions: { ...post.reactions,\n        [reaction]: post.reactions[reaction] += 1\n      }\n    }\n  });\n  return res(ctx.delay(ARTIFICIAL_DELAY_MS), ctx.json(serializePost(updatedPost)));\n}), rest.get('/fakeApi/notifications', (req, res, ctx) => {\n  const numNotifications = getRandomInt(1, 5);\n  let notifications = generateRandomNotifications(undefined, numNotifications, db);\n  return res(ctx.delay(ARTIFICIAL_DELAY_MS), ctx.json(notifications));\n}), rest.get('/fakeApi/users', (req, res, ctx) => {\n  return res(ctx.delay(ARTIFICIAL_DELAY_MS), ctx.json(db.user.getAll()));\n})];\nexport const worker = setupWorker(...handlers); // worker.printHandlers() // Optional: nice for debugging to see all available route handlers that will be intercepted\n\n/* Mock Websocket Setup */\n\nconst socketServer = new MockSocketServer('ws://localhost');\nlet currentSocket;\n\nconst sendMessage = (socket, obj) => {\n  socket.send(JSON.stringify(obj));\n}; // Allow our UI to fake the server pushing out some notifications over the websocket,\n// as if other users were interacting with the system.\n\n\nconst sendRandomNotifications = (socket, since) => {\n  const numNotifications = getRandomInt(1, 5);\n  const notifications = generateRandomNotifications(since, numNotifications, db);\n  sendMessage(socket, {\n    type: 'notifications',\n    payload: notifications\n  });\n};\n\nexport const forceGenerateNotifications = since => {\n  sendRandomNotifications(currentSocket, since);\n};\nsocketServer.on('connection', socket => {\n  currentSocket = socket;\n  socket.on('message', data => {\n    const message = JSON.parse(data);\n\n    switch (message.type) {\n      case 'notifications':\n        {\n          const since = message.payload;\n          sendRandomNotifications(socket, since);\n          break;\n        }\n\n      default:\n        break;\n    }\n  });\n});\n/* Random Notifications Generation */\n\nconst notificationTemplates = ['poked you', 'says hi!', `is glad we're friends`, 'sent you a gift'];\n\nfunction generateRandomNotifications(since, numNotifications, db) {\n  const now = new Date();\n  let pastDate;\n\n  if (since) {\n    pastDate = parseISO(since);\n  } else {\n    pastDate = new Date(now.valueOf());\n    pastDate.setMinutes(pastDate.getMinutes() - 15);\n  } // Create N random notifications. We won't bother saving these\n  // in the DB - just generate a new batch and return them.\n\n\n  const notifications = [...Array(numNotifications)].map(() => {\n    const user = randomFromArray(db.user.getAll());\n    const template = randomFromArray(notificationTemplates);\n    return {\n      id: nanoid(),\n      date: faker.date.between(pastDate, now).toISOString(),\n      message: template,\n      user: user.id\n    };\n  });\n  return notifications;\n}","map":{"version":3,"sources":["/Users/selamhabteab/Desktop/Projects/redux/community-board/src/api/server.js"],"names":["rest","setupWorker","factory","oneOf","manyOf","primaryKey","nanoid","faker","seedrandom","Server","MockSocketServer","setRandom","parseISO","NUM_USERS","POSTS_PER_USER","RECENT_NOTIFICATIONS_DAYS","ARTIFICIAL_DELAY_MS","useSeededRNG","rng","randomSeedString","localStorage","getItem","seedDate","Date","toISOString","setItem","seed","getTime","getRandomInt","min","max","Math","ceil","floor","randomFromArray","array","index","length","db","user","id","firstName","String","lastName","name","username","posts","post","title","date","content","reactions","comments","comment","text","reaction","thumbsUp","Number","hooray","heart","rocket","eyes","createUserData","internet","userName","createPostData","lorem","words","recent","paragraphs","create","i","author","j","newPost","serializePost","handlers","get","req","res","ctx","getAll","map","delay","json","data","body","status","findFirst","where","equals","params","postId","patch","updatedPost","update","numNotifications","notifications","generateRandomNotifications","undefined","worker","socketServer","currentSocket","sendMessage","socket","obj","send","JSON","stringify","sendRandomNotifications","since","type","payload","forceGenerateNotifications","on","message","parse","notificationTemplates","now","pastDate","valueOf","setMinutes","getMinutes","Array","template","between"],"mappings":"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","sourcesContent":["import { rest, setupWorker } from 'msw'\nimport { factory, oneOf, manyOf, primaryKey } from '@mswjs/data'\nimport { nanoid } from '@reduxjs/toolkit'\nimport faker from 'faker'\nimport seedrandom from 'seedrandom'\nimport { Server as MockSocketServer } from 'mock-socket'\nimport { setRandom } from 'txtgen'\n\nimport { parseISO } from 'date-fns'\n\nconst NUM_USERS = 3\nconst POSTS_PER_USER = 3\nconst RECENT_NOTIFICATIONS_DAYS = 7\n\n// Add an extra delay to all endpoints, so loading spinners show up.\nconst ARTIFICIAL_DELAY_MS = 2000\n\n/* RNG setup */\n\n// Set up a seeded random number generator, so that we get\n// a consistent set of users / entries each time the page loads.\n// This can be reset by deleting this localStorage value,\n// or turned off by setting `useSeededRNG` to false.\nlet useSeededRNG = true\n\nlet rng = seedrandom()\n\nif (useSeededRNG) {\n  let randomSeedString = localStorage.getItem('randomTimestampSeed')\n  let seedDate\n\n  if (randomSeedString) {\n    seedDate = new Date(randomSeedString)\n  } else {\n    seedDate = new Date()\n    randomSeedString = seedDate.toISOString()\n    localStorage.setItem('randomTimestampSeed', randomSeedString)\n  }\n\n  rng = seedrandom(randomSeedString)\n  setRandom(rng)\n  faker.seed(seedDate.getTime())\n}\n\nfunction getRandomInt(min, max) {\n  min = Math.ceil(min)\n  max = Math.floor(max)\n  return Math.floor(rng() * (max - min + 1)) + min\n}\n\nconst randomFromArray = (array) => {\n  const index = getRandomInt(0, array.length - 1)\n  return array[index]\n}\n\n/* MSW Data Model Setup */\n\nexport const db = factory({\n  user: {\n    id: primaryKey(nanoid),\n    firstName: String,\n    lastName: String,\n    name: String,\n    username: String,\n    posts: manyOf('post'),\n  },\n  post: {\n    id: primaryKey(nanoid),\n    title: String,\n    date: String,\n    content: String,\n    reactions: oneOf('reaction'),\n    comments: manyOf('comment'),\n    user: oneOf('user'),\n  },\n  comment: {\n    id: primaryKey(String),\n    date: String,\n    text: String,\n    post: oneOf('post'),\n  },\n  reaction: {\n    id: primaryKey(nanoid),\n    thumbsUp: Number,\n    hooray: Number,\n    heart: Number,\n    rocket: Number,\n    eyes: Number,\n    post: oneOf('post'),\n  },\n})\n\nconst createUserData = () => {\n  const firstName = faker.name.firstName()\n  const lastName = faker.name.lastName()\n\n  return {\n    firstName,\n    lastName,\n    name: `${firstName} ${lastName}`,\n    username: faker.internet.userName(),\n  }\n}\n\nconst createPostData = (user) => {\n  return {\n    title: faker.lorem.words(),\n    date: faker.date.recent(RECENT_NOTIFICATIONS_DAYS).toISOString(),\n    user,\n    content: faker.lorem.paragraphs(),\n    reactions: db.reaction.create(),\n  }\n}\n\n// Create an initial set of users and posts\nfor (let i = 0; i < NUM_USERS; i++) {\n  const author = db.user.create(createUserData())\n\n  for (let j = 0; j < POSTS_PER_USER; j++) {\n    const newPost = createPostData(author)\n    db.post.create(newPost)\n  }\n}\n\nconst serializePost = (post) => ({\n  ...post,\n  user: post.user.id,\n})\n\n/* MSW REST API Handlers */\n\nexport const handlers = [\n  rest.get('/fakeApi/posts', function (req, res, ctx) {\n    const posts = db.post.getAll().map(serializePost)\n    return res(ctx.delay(ARTIFICIAL_DELAY_MS), ctx.json(posts))\n  }),\n  rest.post('/fakeApi/posts', function (req, res, ctx) {\n    const data = req.body\n\n    if (data.content === 'error') {\n      return res(\n        ctx.delay(ARTIFICIAL_DELAY_MS),\n        ctx.status(500),\n        ctx.json('Server error saving this post!')\n      )\n    }\n\n    data.date = new Date().toISOString()\n\n    const user = db.user.findFirst({ where: { id: { equals: data.user } } })\n    data.user = user\n    data.reactions = db.reaction.create()\n\n    const post = db.post.create(data)\n    return res(ctx.delay(ARTIFICIAL_DELAY_MS), ctx.json(serializePost(post)))\n  }),\n  rest.get('/fakeApi/posts/:postId', function (req, res, ctx) {\n    const post = db.post.findFirst({\n      where: { id: { equals: req.params.postId } },\n    })\n    return res(ctx.delay(ARTIFICIAL_DELAY_MS), ctx.json(serializePost(post)))\n  }),\n  rest.patch('/fakeApi/posts/:postId', (req, res, ctx) => {\n    const { id, ...data } = req.body\n    const updatedPost = db.post.update({\n      where: { id: { equals: req.params.postId } },\n      data,\n    })\n    return res(\n      ctx.delay(ARTIFICIAL_DELAY_MS),\n      ctx.json(serializePost(updatedPost))\n    )\n  }),\n\n  rest.get('/fakeApi/posts/:postId/comments', (req, res, ctx) => {\n    const post = db.post.findFirst({\n      where: { id: { equals: req.params.postId } },\n    })\n    return res(\n      ctx.delay(ARTIFICIAL_DELAY_MS),\n      ctx.json({ comments: post.comments })\n    )\n  }),\n\n  rest.post('/fakeApi/posts/:postId/reactions', (req, res, ctx) => {\n    const postId = req.params.postId\n    const reaction = req.body.reaction\n    const post = db.post.findFirst({\n      where: { id: { equals: postId } },\n    })\n\n    const updatedPost = db.post.update({\n      where: { id: { equals: postId } },\n      data: {\n        reactions: {\n          ...post.reactions,\n          [reaction]: (post.reactions[reaction] += 1),\n        },\n      },\n    })\n\n    return res(\n      ctx.delay(ARTIFICIAL_DELAY_MS),\n      ctx.json(serializePost(updatedPost))\n    )\n  }),\n  rest.get('/fakeApi/notifications', (req, res, ctx) => {\n    const numNotifications = getRandomInt(1, 5)\n\n    let notifications = generateRandomNotifications(\n      undefined,\n      numNotifications,\n      db\n    )\n\n    return res(ctx.delay(ARTIFICIAL_DELAY_MS), ctx.json(notifications))\n  }),\n  rest.get('/fakeApi/users', (req, res, ctx) => {\n    return res(ctx.delay(ARTIFICIAL_DELAY_MS), ctx.json(db.user.getAll()))\n  }),\n]\n\nexport const worker = setupWorker(...handlers)\n// worker.printHandlers() // Optional: nice for debugging to see all available route handlers that will be intercepted\n\n/* Mock Websocket Setup */\n\nconst socketServer = new MockSocketServer('ws://localhost')\n\nlet currentSocket\n\nconst sendMessage = (socket, obj) => {\n  socket.send(JSON.stringify(obj))\n}\n\n// Allow our UI to fake the server pushing out some notifications over the websocket,\n// as if other users were interacting with the system.\nconst sendRandomNotifications = (socket, since) => {\n  const numNotifications = getRandomInt(1, 5)\n\n  const notifications = generateRandomNotifications(since, numNotifications, db)\n\n  sendMessage(socket, { type: 'notifications', payload: notifications })\n}\n\nexport const forceGenerateNotifications = (since) => {\n  sendRandomNotifications(currentSocket, since)\n}\n\nsocketServer.on('connection', (socket) => {\n  currentSocket = socket\n\n  socket.on('message', (data) => {\n    const message = JSON.parse(data)\n\n    switch (message.type) {\n      case 'notifications': {\n        const since = message.payload\n        sendRandomNotifications(socket, since)\n        break\n      }\n      default:\n        break\n    }\n  })\n})\n\n/* Random Notifications Generation */\n\nconst notificationTemplates = [\n  'poked you',\n  'says hi!',\n  `is glad we're friends`,\n  'sent you a gift',\n]\n\nfunction generateRandomNotifications(since, numNotifications, db) {\n  const now = new Date()\n  let pastDate\n\n  if (since) {\n    pastDate = parseISO(since)\n  } else {\n    pastDate = new Date(now.valueOf())\n    pastDate.setMinutes(pastDate.getMinutes() - 15)\n  }\n\n  // Create N random notifications. We won't bother saving these\n  // in the DB - just generate a new batch and return them.\n  const notifications = [...Array(numNotifications)].map(() => {\n    const user = randomFromArray(db.user.getAll())\n    const template = randomFromArray(notificationTemplates)\n    return {\n      id: nanoid(),\n      date: faker.date.between(pastDate, now).toISOString(),\n      message: template,\n      user: user.id,\n    }\n  })\n\n  return notifications\n}\n"]},"metadata":{},"sourceType":"module"}