{"ast":null,"code":"\"use strict\";\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nexports.__esModule = true;\nexports.defineRelationalProperties = void 0;\n\nvar debug_1 = require(\"debug\");\n\nvar glossary_1 = require(\"../glossary\");\n\nvar executeQuery_1 = require(\"../query/executeQuery\");\n\nvar first_1 = require(\"../utils/first\");\n\nvar log = debug_1.debug('defineRelationalProperties');\n\nfunction defineRelationalProperties(entity, initialValues, relations, db) {\n  log('setting relations', relations, entity);\n  var properties = Object.entries(relations).reduce(function (properties, _a) {\n    var _b, _c;\n\n    var _d = __read(_a, 2),\n        property = _d[0],\n        relation = _d[1];\n\n    log(\"defining relational property \\\"\" + entity.__type + \".\" + property + \"\\\"\", relation);\n    if (!(property in initialValues)) return properties; // Take the relational entity reference from the initial values.\n\n    var entityRefs = [].concat(initialValues[property]);\n\n    if (relation.unique) {\n      log(\"verifying that the \\\"\" + property + \"\\\" relation is unique...\"); // Trying to look up an entity of the same type\n      // that references the same relational entity.\n\n      var existingEntities = executeQuery_1.executeQuery(entity[glossary_1.InternalEntityProperty.type], entity[glossary_1.InternalEntityProperty.primaryKey], {\n        where: (_b = {}, _b[property] = (_c = {}, _c[relation.primaryKey] = {\n          \"in\": entityRefs.map(function (entityRef) {\n            return entityRef[entity[glossary_1.InternalEntityProperty.primaryKey]];\n          })\n        }, _c), _b)\n      }, db);\n      log(\"existing entities that reference the same \\\"\" + property + \"\\\"\", existingEntities);\n\n      if (existingEntities.length > 0) {\n        log(\"found a non-unique relational entity!\");\n        throw new Error(\"Failed to create a unique \\\"\" + relation.modelName + \"\\\" relation for \\\"\" + entity.__type + \".\" + property + \"\\\" (\" + entity[entity[glossary_1.InternalEntityProperty.primaryKey]] + \"): the provided entity is already used.\");\n      }\n    }\n\n    properties[property] = {\n      enumerable: true,\n      get: function () {\n        log(\"get \\\"\" + property + \"\\\"\", relation);\n        var refValue = entityRefs.reduce(function (list, entityRef) {\n          var _a;\n\n          return list.concat(executeQuery_1.executeQuery(relation.modelName, relation.primaryKey, {\n            where: (_a = {}, _a[relation.primaryKey] = {\n              equals: entityRef[relation.primaryKey]\n            }, _a)\n          }, db));\n        }, []);\n        log(\"resolved \\\"\" + relation.kind + \"\\\" \\\"\" + property + \"\\\" to\", refValue);\n        return relation.kind === glossary_1.RelationKind.OneOf ? first_1.first(refValue) : refValue;\n      }\n    };\n    return properties;\n  }, {});\n  Object.defineProperties(entity, properties);\n}\n\nexports.defineRelationalProperties = defineRelationalProperties;","map":{"version":3,"sources":["/Users/selamhabteab/Desktop/Projects/redux/community-board/node_modules/@mswjs/data/lib/model/defineRelationalProperties.js"],"names":["__read","o","n","m","Symbol","iterator","i","call","r","ar","e","next","done","push","value","error","exports","__esModule","defineRelationalProperties","debug_1","require","glossary_1","executeQuery_1","first_1","log","debug","entity","initialValues","relations","db","properties","Object","entries","reduce","_a","_b","_c","_d","property","relation","__type","entityRefs","concat","unique","existingEntities","executeQuery","InternalEntityProperty","type","primaryKey","where","map","entityRef","length","Error","modelName","enumerable","get","refValue","list","equals","kind","RelationKind","OneOf","first","defineProperties"],"mappings":"AAAA;;AACA,IAAIA,MAAM,GAAI,QAAQ,KAAKA,MAAd,IAAyB,UAAUC,CAAV,EAAaC,CAAb,EAAgB;AAClD,MAAIC,CAAC,GAAG,OAAOC,MAAP,KAAkB,UAAlB,IAAgCH,CAAC,CAACG,MAAM,CAACC,QAAR,CAAzC;AACA,MAAI,CAACF,CAAL,EAAQ,OAAOF,CAAP;AACR,MAAIK,CAAC,GAAGH,CAAC,CAACI,IAAF,CAAON,CAAP,CAAR;AAAA,MAAmBO,CAAnB;AAAA,MAAsBC,EAAE,GAAG,EAA3B;AAAA,MAA+BC,CAA/B;;AACA,MAAI;AACA,WAAO,CAACR,CAAC,KAAK,KAAK,CAAX,IAAgBA,CAAC,KAAK,CAAvB,KAA6B,CAAC,CAACM,CAAC,GAAGF,CAAC,CAACK,IAAF,EAAL,EAAeC,IAApD,EAA0DH,EAAE,CAACI,IAAH,CAAQL,CAAC,CAACM,KAAV;AAC7D,GAFD,CAGA,OAAOC,KAAP,EAAc;AAAEL,IAAAA,CAAC,GAAG;AAAEK,MAAAA,KAAK,EAAEA;AAAT,KAAJ;AAAuB,GAHvC,SAIQ;AACJ,QAAI;AACA,UAAIP,CAAC,IAAI,CAACA,CAAC,CAACI,IAAR,KAAiBT,CAAC,GAAGG,CAAC,CAAC,QAAD,CAAtB,CAAJ,EAAuCH,CAAC,CAACI,IAAF,CAAOD,CAAP;AAC1C,KAFD,SAGQ;AAAE,UAAII,CAAJ,EAAO,MAAMA,CAAC,CAACK,KAAR;AAAgB;AACpC;;AACD,SAAON,EAAP;AACH,CAfD;;AAgBAO,OAAO,CAACC,UAAR,GAAqB,IAArB;AACAD,OAAO,CAACE,0BAAR,GAAqC,KAAK,CAA1C;;AACA,IAAIC,OAAO,GAAGC,OAAO,CAAC,OAAD,CAArB;;AACA,IAAIC,UAAU,GAAGD,OAAO,CAAC,aAAD,CAAxB;;AACA,IAAIE,cAAc,GAAGF,OAAO,CAAC,uBAAD,CAA5B;;AACA,IAAIG,OAAO,GAAGH,OAAO,CAAC,gBAAD,CAArB;;AACA,IAAII,GAAG,GAAGL,OAAO,CAACM,KAAR,CAAc,4BAAd,CAAV;;AACA,SAASP,0BAAT,CAAoCQ,MAApC,EAA4CC,aAA5C,EAA2DC,SAA3D,EAAsEC,EAAtE,EAA0E;AACtEL,EAAAA,GAAG,CAAC,mBAAD,EAAsBI,SAAtB,EAAiCF,MAAjC,CAAH;AACA,MAAII,UAAU,GAAGC,MAAM,CAACC,OAAP,CAAeJ,SAAf,EAA0BK,MAA1B,CAAiC,UAAUH,UAAV,EAAsBI,EAAtB,EAA0B;AACxE,QAAIC,EAAJ,EAAQC,EAAR;;AACA,QAAIC,EAAE,GAAGrC,MAAM,CAACkC,EAAD,EAAK,CAAL,CAAf;AAAA,QAAwBI,QAAQ,GAAGD,EAAE,CAAC,CAAD,CAArC;AAAA,QAA0CE,QAAQ,GAAGF,EAAE,CAAC,CAAD,CAAvD;;AACAb,IAAAA,GAAG,CAAC,oCAAoCE,MAAM,CAACc,MAA3C,GAAoD,GAApD,GAA0DF,QAA1D,GAAqE,IAAtE,EAA4EC,QAA5E,CAAH;AACA,QAAI,EAAED,QAAQ,IAAIX,aAAd,CAAJ,EACI,OAAOG,UAAP,CALoE,CAMxE;;AACA,QAAIW,UAAU,GAAG,GAAGC,MAAH,CAAUf,aAAa,CAACW,QAAD,CAAvB,CAAjB;;AACA,QAAIC,QAAQ,CAACI,MAAb,EAAqB;AACjBnB,MAAAA,GAAG,CAAC,0BAA0Bc,QAA1B,GAAqC,0BAAtC,CAAH,CADiB,CAEjB;AACA;;AACA,UAAIM,gBAAgB,GAAGtB,cAAc,CAACuB,YAAf,CAA4BnB,MAAM,CAACL,UAAU,CAACyB,sBAAX,CAAkCC,IAAnC,CAAlC,EAA4ErB,MAAM,CAACL,UAAU,CAACyB,sBAAX,CAAkCE,UAAnC,CAAlF,EAAkI;AACrJC,QAAAA,KAAK,GAAGd,EAAE,GAAG,EAAL,EACJA,EAAE,CAACG,QAAD,CAAF,IAAgBF,EAAE,GAAG,EAAL,EACZA,EAAE,CAACG,QAAQ,CAACS,UAAV,CAAF,GAA0B;AACtB,gBAAMP,UAAU,CAACS,GAAX,CAAe,UAAUC,SAAV,EAAqB;AACtC,mBAAOA,SAAS,CAACzB,MAAM,CAACL,UAAU,CAACyB,sBAAX,CAAkCE,UAAnC,CAAP,CAAhB;AACH,WAFK;AADgB,SADd,EAMZZ,EANJ,CADI,EAQJD,EARC;AADgJ,OAAlI,EAUpBN,EAVoB,CAAvB;AAWAL,MAAAA,GAAG,CAAC,iDAAiDc,QAAjD,GAA4D,IAA7D,EAAmEM,gBAAnE,CAAH;;AACA,UAAIA,gBAAgB,CAACQ,MAAjB,GAA0B,CAA9B,EAAiC;AAC7B5B,QAAAA,GAAG,CAAC,uCAAD,CAAH;AACA,cAAM,IAAI6B,KAAJ,CAAU,iCAAiCd,QAAQ,CAACe,SAA1C,GAAsD,oBAAtD,GAA6E5B,MAAM,CAACc,MAApF,GAA6F,GAA7F,GAAmGF,QAAnG,GAA8G,MAA9G,GAAuHZ,MAAM,CAACA,MAAM,CAACL,UAAU,CAACyB,sBAAX,CAAkCE,UAAnC,CAAP,CAA7H,GAAsL,yCAAhM,CAAN;AACH;AACJ;;AACDlB,IAAAA,UAAU,CAACQ,QAAD,CAAV,GAAuB;AACnBiB,MAAAA,UAAU,EAAE,IADO;AAEnBC,MAAAA,GAAG,EAAE,YAAY;AACbhC,QAAAA,GAAG,CAAC,WAAWc,QAAX,GAAsB,IAAvB,EAA6BC,QAA7B,CAAH;AACA,YAAIkB,QAAQ,GAAGhB,UAAU,CAACR,MAAX,CAAkB,UAAUyB,IAAV,EAAgBP,SAAhB,EAA2B;AACxD,cAAIjB,EAAJ;;AACA,iBAAOwB,IAAI,CAAChB,MAAL,CAAYpB,cAAc,CAACuB,YAAf,CAA4BN,QAAQ,CAACe,SAArC,EAAgDf,QAAQ,CAACS,UAAzD,EAAqE;AACpFC,YAAAA,KAAK,GAAGf,EAAE,GAAG,EAAL,EACJA,EAAE,CAACK,QAAQ,CAACS,UAAV,CAAF,GAA0B;AACtBW,cAAAA,MAAM,EAAER,SAAS,CAACZ,QAAQ,CAACS,UAAV;AADK,aADtB,EAIJd,EAJC;AAD+E,WAArE,EAMhBL,EANgB,CAAZ,CAAP;AAOH,SATc,EASZ,EATY,CAAf;AAUAL,QAAAA,GAAG,CAAC,gBAAgBe,QAAQ,CAACqB,IAAzB,GAAgC,OAAhC,GAA0CtB,QAA1C,GAAqD,OAAtD,EAA+DmB,QAA/D,CAAH;AACA,eAAOlB,QAAQ,CAACqB,IAAT,KAAkBvC,UAAU,CAACwC,YAAX,CAAwBC,KAA1C,GACDvC,OAAO,CAACwC,KAAR,CAAcN,QAAd,CADC,GAEDA,QAFN;AAGH;AAlBkB,KAAvB;AAoBA,WAAO3B,UAAP;AACH,GAlDgB,EAkDd,EAlDc,CAAjB;AAmDAC,EAAAA,MAAM,CAACiC,gBAAP,CAAwBtC,MAAxB,EAAgCI,UAAhC;AACH;;AACDd,OAAO,CAACE,0BAAR,GAAqCA,0BAArC","sourcesContent":["\"use strict\";\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nexports.__esModule = true;\nexports.defineRelationalProperties = void 0;\nvar debug_1 = require(\"debug\");\nvar glossary_1 = require(\"../glossary\");\nvar executeQuery_1 = require(\"../query/executeQuery\");\nvar first_1 = require(\"../utils/first\");\nvar log = debug_1.debug('defineRelationalProperties');\nfunction defineRelationalProperties(entity, initialValues, relations, db) {\n    log('setting relations', relations, entity);\n    var properties = Object.entries(relations).reduce(function (properties, _a) {\n        var _b, _c;\n        var _d = __read(_a, 2), property = _d[0], relation = _d[1];\n        log(\"defining relational property \\\"\" + entity.__type + \".\" + property + \"\\\"\", relation);\n        if (!(property in initialValues))\n            return properties;\n        // Take the relational entity reference from the initial values.\n        var entityRefs = [].concat(initialValues[property]);\n        if (relation.unique) {\n            log(\"verifying that the \\\"\" + property + \"\\\" relation is unique...\");\n            // Trying to look up an entity of the same type\n            // that references the same relational entity.\n            var existingEntities = executeQuery_1.executeQuery(entity[glossary_1.InternalEntityProperty.type], entity[glossary_1.InternalEntityProperty.primaryKey], {\n                where: (_b = {},\n                    _b[property] = (_c = {},\n                        _c[relation.primaryKey] = {\n                            \"in\": entityRefs.map(function (entityRef) {\n                                return entityRef[entity[glossary_1.InternalEntityProperty.primaryKey]];\n                            })\n                        },\n                        _c),\n                    _b)\n            }, db);\n            log(\"existing entities that reference the same \\\"\" + property + \"\\\"\", existingEntities);\n            if (existingEntities.length > 0) {\n                log(\"found a non-unique relational entity!\");\n                throw new Error(\"Failed to create a unique \\\"\" + relation.modelName + \"\\\" relation for \\\"\" + entity.__type + \".\" + property + \"\\\" (\" + entity[entity[glossary_1.InternalEntityProperty.primaryKey]] + \"): the provided entity is already used.\");\n            }\n        }\n        properties[property] = {\n            enumerable: true,\n            get: function () {\n                log(\"get \\\"\" + property + \"\\\"\", relation);\n                var refValue = entityRefs.reduce(function (list, entityRef) {\n                    var _a;\n                    return list.concat(executeQuery_1.executeQuery(relation.modelName, relation.primaryKey, {\n                        where: (_a = {},\n                            _a[relation.primaryKey] = {\n                                equals: entityRef[relation.primaryKey]\n                            },\n                            _a)\n                    }, db));\n                }, []);\n                log(\"resolved \\\"\" + relation.kind + \"\\\" \\\"\" + property + \"\\\" to\", refValue);\n                return relation.kind === glossary_1.RelationKind.OneOf\n                    ? first_1.first(refValue)\n                    : refValue;\n            }\n        };\n        return properties;\n    }, {});\n    Object.defineProperties(entity, properties);\n}\nexports.defineRelationalProperties = defineRelationalProperties;\n"]},"metadata":{},"sourceType":"script"}